<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Database Management</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f4f4f4;
    }

    .container {
      text-align: left;
      margin-top: 50px;
      overflow: auto; /* Add overflow property for scrolling */
      max-height: 70vh; /* Set a maximum height for the scrollable area */
    }

    div {
      margin-bottom: 15px;
    }

    label {
      display: inline-block;
      width: 120px;
      margin-right: 10px;
    }

    input, select {
      padding: 8px;
      width: 200px;
    }

    select {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 8px;
      width: 150px;
      opacity: 0.8;
      border-radius: 4px;
    }

    button {
      background-color: #4caf50;
      color: white;
      padding: 8px 12px;
      border: none;
      cursor: pointer;
    }

    input[type="file"] {
      display: none;
    }

    .file-upload-btn {
      background-color: transparent;
      color: #4caf50;
      padding: 8px 12px;
      border: 2px solid #4caf50;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
  .display-area {
    max-height: 150px; /* Set the maximum height for the scrollable display area */
    max-width: 600px; 
    overflow: auto; /* Enable scrolling */
    border: 1px solid #ccc; 
    padding: 10px; 
    background-color: white; 
    margin: 0 auto; /*  display area horizontally */
  }

    .file-upload-btn:hover {
      background-color: #4caf50;
      color: white;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Database Selection Dropdown with Load Button -->
  <div>
    <label for="databaseSelect">Database:</label>
    <select id="databaseSelect" onchange="selectDatabase()">
      <option value="nosql">NoSQL</option>
      <option value="relational">Relational Database</option>
    </select>
    
  
    <input type="file" id="fileInput" style="display:none" accept=".csv, .json" onchange="handleFileSelection()" />
    
    <button class="file-upload-btn" onclick="uploadFile()">Load</button>
  </div>

  <!-- Create Table Section -->
  <div>
    <label for="createInput">Create:</label>
    <input type="text" id="createInput" placeholder="Table name">
    <input type="text" id="createInput2" placeholder="field">
    <button onclick="createTable()">Create</button>
  </div>

  <!-- Insert Data Section -->
  <div>
    <label for="insertInput">Insert:</label>
    <input type="text" id="insertInput" placeholder="Table name">
    <input type="text" id="insertInput2" placeholder="Data">
    <button onclick="insertData()">Insert</button>
  </div>

  <!-- delete Data Section -->

  <div>
    <label for="deleteInput">Delete:</label>
    <input type="text" id="deleteInput" placeholder="Table name">
    <input type="text" id="deleteInput2" placeholder="Condition">
    <button onclick="deleteData()">Delete</button>
  </div>

  <!-- Update Data Section -->
  <div>
    <label for="updateInput">Update:</label>
    <input type="text" id="updateInput" placeholder="Table name">
    <input type="text" id="updateInput2" placeholder="Updated data">
    <input type="text" id="updateInput3" placeholder="original data">
    <button onclick="updateData()">Update</button>
  </div>

  <!-- Projection Section -->
  <div>
    <label for="projectionInput">Projection:</label>
    <input type="text" id="projectionInput" placeholder="Table name">
    <input type="text" id="projectionInput2" placeholder="Fields to project">
    <button onclick="projectFields()">Project</button>
  </div>

  <!-- Filtering Section -->
  <div>
    <label for="filteringInput">Filtering:</label>
    <input type="text" id="filteringInput" placeholder="Table name">
    <input type="text" id="filteringInput2" placeholder="Filter criteria">
    <input type="text" id="filteringInput3" placeholder="Fields to display">
    <button onclick="applyFilter()">Filter</button>
  </div>

  <!-- Aggregation Section -->
  <div>
    <label for="aggregationInput">Aggregation:</label>
    <input type="text" id="aggregationInput" placeholder="Table name">
    <input type="text" id="aggregationInput2" placeholder="Aggregation operation">
    <input type="text" id="aggregationInput3" placeholder="Fields to group by">
    <input type="text" id="aggregationInput4" placeholder="Field to aggregate">
    <button onclick="performAggregation()">Aggregate</button>
</div>
  


  <!-- Order Section -->
  <div>
    <label for="orderInput">Order:</label>
    <input type="text" id="orderInput" placeholder="Table name">
    <input type="text" id="orderInput2" placeholder="Fields to order by">
    <input type="text" id="orderInput3" placeholder="Order direction">
    <button onclick="applyOrder()">Order</button>
  </div>
  
    <div>
    <label for="joinInput1">Join:</label>
    <input type="text" id="joinInput1" placeholder="Table name">
    <input type="text" id="joinInput2" placeholder="Table name">
    <input type="text" id="joinInput3" placeholder="Join condition">
    <button onclick="performJoin()">Join</button>
  </div>
  
  
   <div class="display-area" id="displayArea">
    <!-- Content can be displayed  -->
  </div>
</div>

<script>


//   function addContentToDisplayArea(content) {
    
//     const displayArea = document.getElementById('displayArea');
//     displayArea.innerHTML = content;
// }

function addContentToDisplayArea(content) {
    const displayArea = document.getElementById('displayArea');

    // Clear existing content
    displayArea.innerHTML = '';

    // Check if content is a string
    if (typeof content === 'string') {
        // If content is a string, directly append it to the display area
        displayArea.appendChild(document.createTextNode(content));
    } else {
        console.error('Unknown content type:', content);
    }
}


  // window.onload = addContentToDisplayArea;
</script>

<script>
  function selectDatabase() {
    const selectedDatabase = document.getElementById('databaseSelect').value;
    console.log(`Selected Database: ${selectedDatabase}`);
  }

  function uploadFile() {
    const fileInput = document.getElementById('fileInput');
    fileInput.click(); // Trigger the hidden file input
  }

  function handleFileSelection() {
    const selectedFile = document.getElementById('fileInput').files[0];
    if (selectedFile) {
      const formData = new FormData();
      formData.append('file', selectedFile);

      // Use fetch API 
      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log(data); 
      
      })
      .catch(error => console.error('Error:', error));
    }

  }

  function createTable() {
    // Get values from input fields
    var tableName = document.getElementById('createInput').value;
    var field = document.getElementById('createInput2').value;

    // Log values before sending the request
    console.log('Table Name:', tableName);
    console.log('Fields:', field);

    // Send a POST request using the Fetch API
    fetch('/create_table', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            table_name: tableName,
            fields: field
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        // Check if the element with id 'resultMessage' exists before setting innerText
        var resultMessageElement = document.getElementById('resultMessage');
        if (resultMessageElement) {
            resultMessageElement.innerText = data.result;
        } else {
            console.error('Element with id "resultMessage" not found.');
        }
    })
    .catch(error => {
        console.error('Error:', error);

        // Check if the element with id 'resultMessage' exists before setting innerText
        var resultMessageElement = document.getElementById('resultMessage');
        if (resultMessageElement) {
            resultMessageElement.innerText = 'Error occurred while creating the table.';
        } else {
            console.error('Element with id "resultMessage" not found.');
        }
    });

    // Prevent the default form submission
    return false;
}

  // function createTable() {
  //       // Get form values
  //       var tableName = document.getElementById('createInput').value;
  //       var field = document.getElementById('createInput2').value;

  //       console.log('Table Name:', tableName);
  //   console.log('Fields:', field);

  //       // Check for empty values
  //       if (!tableName || !field) {
  //           document.getElementById('resultMessage').innerText = 'Table name and field cannot be empty.';
  //           return false;
  //       }

  //       // Send a POST request using the Fetch API
  //       fetch('/create_table', {
  //           method: 'POST',
  //           headers: {
  //               'Content-Type': 'application/json'
  //           },
  //           body: JSON.stringify({
  //               table_name: tableName,
  //               fields: field  // Send fields as a single string
  //           })
  //       })
  //       .then(response => {
  //           // Check for successful response status
  //           if (!response.ok) {
  //               throw new Error(`HTTP error! Status: ${response.status}`);
  //           }
  //           return response.json();
  //       })
  //       .then(data => {
  //           // Handle the response data
  //           console.log(data);
  //           document.getElementById('resultMessage').innerText = data.result;
  //       })
  //       .catch(error => {
  //           console.error('Error:', error);
  //           document.getElementById('resultMessage').innerText = 'Error occurred while creating the table.';
  //       });

  //       // Prevent the default form submission
  //       return false;
  //   }
  

  function insertData() {
    const tableName = document.getElementById('insertInput').value;
    const data = document.getElementById('insertInput2').value;

    // Make an AJAX request to the Flask /insert route
    fetch('/insert', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'table_name': tableName,
            'data': data,
        }),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addContentToDisplayArea('Insert successful');
            // Reset input fields
            document.getElementById('insertInput').value = '';
            document.getElementById('insertInput2').value = '';
        } else {
            addContentToDisplayArea(`Error: ${result.error}`);
        }
    })
    .catch(error => {
        addContentToDisplayArea(`Error: ${error}`);
    });
}

function updateData() {
    const tableName = document.getElementById('updateInput').value;
    const updatedData = document.getElementById('updateInput2').value;
    const condition = document.getElementById('updateInput3').value;

    // Make an AJAX request to the /update route
    fetch('/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `tableName=${tableName}&updatedData=${updatedData}&condition=${condition}`,
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addContentToDisplayArea('Update successful');
            // Reset input fields
            document.getElementById('updateInput').value = '';
            document.getElementById('updateInput2').value = '';
            document.getElementById('updateInput3').value = '';
        } else {
            addContentToDisplayArea(`Update failed: ${result.error}`);
        }
    })
    .catch(error => {
        console.error('Error during update:', error);
        addContentToDisplayArea('Error during update. Please check the console for details.');
    });
}

// function projectFields() {
//     const tableName = document.getElementById('projectionInput').value;
//     const fieldsToProject = document.getElementById('projectionInput2').value;

//     // Make an AJAX request to the Flask /projection route
//     fetch('/projection', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/x-www-form-urlencoded',
//         },
//         body: new URLSearchParams({
//             'table_name': tableName,
//             'fields': fieldsToProject,
//         }),
//     })
//     .then(response => response.json())
//     .then(result => {
//         if (result.success) {
//             // Display the result in the display area
//             addContentToDisplayArea(result.content);
//         } else {
//             addContentToDisplayArea(`Error: ${result.error}`);
//         }
//     })
//     .catch(error => {
//         addContentToDisplayArea(`Error: ${error}`);
//     });
// }

function projectFields() {
    const tableNameInput = document.getElementById('projectionInput');
    const fieldsToProjectInput = document.getElementById('projectionInput2');

    const tableName = tableNameInput.value;
    const fieldsToProject = fieldsToProjectInput.value;

    // Make an AJAX request to the Flask /projection route
    fetch('/projection', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json', // Set the content type to JSON
        },
        body: JSON.stringify({
            'table_name': tableName,
            'fields': fieldsToProject,
        }),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addContentToDisplayArea(result.content);
            // Clear the input fields
            tableNameInput.value = '';
            fieldsToProjectInput.value = '';
        } else {
            addContentToDisplayArea(`Error: ${result.error}`);
        }
    })
    .catch(error => {
        addContentToDisplayArea(`Error: ${error}`);
    });
}

function applyFilter() {
    const tableNameInput = document.getElementById('filteringInput');
    const filterCriteriaInput = document.getElementById('filteringInput2');
    const fieldsToDisplayInput = document.getElementById('filteringInput3');

    const tableName = tableNameInput.value;
    const filterCriteria = filterCriteriaInput.value;
    const fieldsToDisplay = fieldsToDisplayInput.value;

    console.log(`Applying Filter in Table: ${tableName}, Criteria: ${filterCriteria}, Fields: ${fieldsToDisplay}`);

    // Make an AJAX request to the Flask /filter route
    fetch('/filter', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'table_name': tableName,
            'fields': fieldsToDisplay,
            'condition': filterCriteria,
        }),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addContentToDisplayArea(result.output);
            
            // Clear the input fields
            tableNameInput.value = '';
            filterCriteriaInput.value = '';
            fieldsToDisplayInput.value = '';
        } else {
            addContentToDisplayArea(`Error: ${result.error}`);
        }
    })
    .catch(error => {
        addContentToDisplayArea(`Error: ${error}`);
    });
}

function deleteData() {
    var tableName = document.getElementById('deleteInput').value;
    var condition = document.getElementById('deleteInput2').value;

    fetch('/delete_data', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            table_name: tableName,
            condition: condition
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        var resultMessageElement = document.getElementById('resultMessage');
        if (resultMessageElement) {
            resultMessageElement.innerText = data.result;
        } else {
            console.error('Element with id "resultMessage" not found.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        var resultMessageElement = document.getElementById('resultMessage');
        if (resultMessageElement) {
            resultMessageElement.innerText = 'Error occurred while deleting data.';
        } else {
            console.error('Element with id "resultMessage" not found.');
        }
    });

    return false;
}

function performAggregation() {
    const tableName = document.getElementById('aggregationInput').value;
    const aggregateMethod = document.getElementById('aggregationInput2').value;
    const aggregateField = document.getElementById('aggregationInput3').value;
    const groupByField = document.getElementById('aggregationInput4').value;

    fetch('/aggregate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'table_name': tableName,
            'aggregate_method': aggregateMethod,
            'aggregate_field': aggregateField,
            'group_by_field': groupByField,
        }),
    })
    .then(response => response.json())
    .then(result => {
        console.log('Received Result:', result);

        if (result.success) {
            addContentToDisplayArea(result.result);
        } else {
            addContentToDisplayArea(`Error: ${result.error}`);
        }
    })
    .catch(error => {
        console.error('Error during aggregation:', error);
        addContentToDisplayArea(`Error: ${error}`);
    });
}

function performOrder() {
    const tableName = document.getElementById('orderInput').value;
    const orderByField = document.getElementById('orderInput2').value;
    const orderDirection = document.getElementById('orderInput3').value;

    // Make an AJAX request to the Flask /order route
    fetch('/order', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            'table_name': tableName,
            'field': orderByField,
            'order_method': orderDirection,
        }),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addContentToDisplayArea('Order successful');
            // Reset input fields
            document.getElementById('orderInput').value = '';
            document.getElementById('orderInput2').value = '';
            document.getElementById('orderInput3').value = '';
        } else {
            addContentToDisplayArea(`Order failed: ${result.error}`);
        }
    })
    .catch(error => {
        console.error('Error during order:', error);
        addContentToDisplayArea('Error during order. Please check the console for details.');
    });
}


  function applyOrder() {
    performOrder();
  }
  
  function performJoin() {
    const table1 = document.getElementById('joinInput1').value;
    const table2 = document.getElementById('joinInput2').value;
    const condition = document.getElementById('joinInput3').value;

    // Make an AJAX request to the Flask /join route
    fetch('/join', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'table1': table1,
            'table2': table2,
            'condition': condition,
        }),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addContentToDisplayArea('Join successful');
        } else {
            addContentToDisplayArea(`Error: ${result.error}`);
        }
    })
    .catch(error => {
        addContentToDisplayArea(`Error: ${error}`);
    });
}
  
</script>
</body>
</html>